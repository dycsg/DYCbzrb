<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./logo.ico" type="image/x-icon">
    <title>ç­é•¿æ—¥æŠ¥ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 15px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: #f9f9f9;
            border-left: 4px solid #3498db;
        }

        .section h2 {
            color: #2980b9;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        input,
        select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 15px;
            transition: border 0.3s;
        }

        input:focus,
        select:focus {
            border-color: #3498db;
            outline: none;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            display: block;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            background-color: #2980b9;
        }

        .report-container {
            margin-top: 25px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }

        .report-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }

        .report-section {
            margin-bottom: 25px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .no-data {
            text-align: center;
            color: #7f8c8d;
            padding: 15px;
            font-style: italic;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .hidden {
            display: none;
        }

        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .upload-area:hover {
            background-color: #f0f8ff;
        }

        .file-info {
            margin-top: 10px;
            font-size: 14px;
            color: #7f8c8d;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-uploaded {
            background-color: #2ecc71;
        }

        .status-pending {
            background-color: #f39c12;
        }

        .print-btn {
            background-color: #27ae60;
            width: auto;
            margin: 20px auto 0;
            padding: 10px 25px;
        }

        .print-btn:hover {
            background-color: #219653;
        }

        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-icon {
            margin-right: 10px;
            color: #3498db;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ç­é•¿æ—¥æŠ¥ç”Ÿæˆå™¨</h1>

        <div class="section">
            <h2>æ•°æ®ä¸Šä¼ </h2>
            <div class="form-group">
                <div id="uploadArea" class="upload-area">
                    <p>ç‚¹å‡»æˆ–æ‹–æ‹½Excelæ–‡ä»¶åˆ°è¿™é‡Œä¸Šä¼ </p>
                    <p class="file-info">æ”¯æŒå¤šsheetçš„Excelæ–‡ä»¶</p>
                </div>
                <input type="file" id="fileInput" accept=".xlsx, .xls" style="display: none;">
                <div id="uploadStatus" class="file-info">
                    <span class="status-indicator status-pending"></span>ç­‰å¾…ä¸Šä¼ æ–‡ä»¶
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ç­›é€‰æ¡ä»¶</h2>
            <div class="form-group">
                <label for="leaderName">é€‰æ‹©ç­é•¿å§“åï¼š</label>
                <select id="leaderName">
                    <option value="">-- è¯·é€‰æ‹©ç­é•¿ --</option>
                </select>
            </div>
            <button id="generateReport">ç”Ÿæˆæ—¥æŠ¥</button>
        </div>

        <div id="reportContainer" class="report-container hidden">
            <div class="report-header">
                <h2>ç­é•¿æ—¥æŠ¥</h2>
                <p id="reportDate"></p>
                <p>ç­é•¿ï¼š<span id="reportLeaderName"></span></p>
            </div>

            <div class="report-section">
                <div class="section-title">
                    <span class="section-icon">ğŸ“Š</span>
                    <h3>ç„Šå£æ•°æ®</h3>
                </div>
                <div id="weldData" class="no-data">æ— ç›¸å…³æ•°æ®</div>
            </div>

            <div class="report-section">
                <div class="section-title">
                    <span class="section-icon">ğŸ”§</span>
                    <h3>ä¸€é˜¶æ®µæ•°æ®</h3>
                </div>
                <div id="stage1Data" class="no-data">æ— ç›¸å…³æ•°æ®</div>
            </div>

            <div class="report-section">
                <div class="section-title">
                    <span class="section-icon">ğŸ—ï¸</span>
                    <h3>äºŒé˜¶æ®µå®‰è£…æ•°æ®</h3>
                </div>
                <div id="stage2InstallData" class="no-data">æ— ç›¸å…³æ•°æ®</div>
            </div>

            <div class="report-section">
                <div class="section-title">
                    <span class="section-icon">ğŸ”©</span>
                    <h3>äºŒé˜¶æ®µé¢„åˆ¶æ•°æ®</h3>
                </div>
                <div id="stage2PrefabData" class="no-data">æ— ç›¸å…³æ•°æ®</div>
            </div>

            <button id="printReport" class="print-btn">æ‰“å°æ—¥æŠ¥</button>
        </div>
    </div>

    <!-- å¼•å…¥SheetJSåº“ç”¨äºå¤„ç†Excelæ–‡ä»¶ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // å…¨å±€å˜é‡å­˜å‚¨Excelæ•°æ®
        let excelData = {};
        let leaderNames = [];

        // é¡µé¢å…ƒç´ 
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const uploadStatus = document.getElementById('uploadStatus');
        const leaderNameSelect = document.getElementById('leaderName');
        const generateReportBtn = document.getElementById('generateReport');
        const printReportBtn = document.getElementById('printReport');
        const reportContainer = document.getElementById('reportContainer');
        const reportDate = document.getElementById('reportDate');
        const reportLeaderName = document.getElementById('reportLeaderName');
        const weldData = document.getElementById('weldData');
        const stage1Data = document.getElementById('stage1Data');
        const stage2InstallData = document.getElementById('stage2InstallData');
        const stage2PrefabData = document.getElementById('stage2PrefabData');

        // ä¸Šä¼ åŒºåŸŸç‚¹å‡»äº‹ä»¶
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        fileInput.addEventListener('change', handleFileUpload);

        // æ‹–æ”¾äº‹ä»¶
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = '#f0f8ff';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.backgroundColor = '';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = '';
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileUpload();
            }
        });

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload() {
            const file = fileInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });

                    // æ¸…ç©ºä¹‹å‰çš„æ•°æ®
                    excelData = {};
                    leaderNames = [];

                    // å¤„ç†æ¯ä¸ªsheet
                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        excelData[sheetName] = jsonData;

                        // æå–ç­é•¿å§“å
                        if (jsonData.length > 0) {
                            // å‡è®¾ç­é•¿å§“ååœ¨"ç­é•¿"æˆ–"è´Ÿè´£äºº"åˆ—
                            const leaderKey = Object.keys(jsonData[0]).find(key =>
                                key.includes('ç­é•¿') || key.includes('è´Ÿè´£äºº') || key.includes('å§“å')
                            );

                            if (leaderKey) {
                                jsonData.forEach(row => {
                                    if (row[leaderKey] && !leaderNames.includes(row[leaderKey])) {
                                        leaderNames.push(row[leaderKey]);
                                    }
                                });
                            }
                        }
                    });

                    // æ›´æ–°ç­é•¿å§“åä¸‹æ‹‰æ¡†
                    updateLeaderSelect();

                    // æ›´æ–°ä¸Šä¼ åŒºåŸŸæ˜¾ç¤º
                    uploadArea.innerHTML = `<p>å·²ä¸Šä¼ : ${file.name}</p><p class="file-info">å…± ${workbook.SheetNames.length} ä¸ªsheet</p>`;
                    uploadStatus.innerHTML = `<span class="status-indicator status-uploaded"></span>æ–‡ä»¶å·²ä¸Šä¼ ï¼Œå…± ${workbook.SheetNames.length} ä¸ªsheet`;

                    alert('æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼');
                } catch (error) {
                    console.error('Error processing file:', error);
                    alert('æ–‡ä»¶å¤„ç†å‡ºé”™ï¼Œè¯·ç¡®ä¿ä¸Šä¼ çš„æ˜¯æœ‰æ•ˆçš„Excelæ–‡ä»¶ã€‚');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // æ›´æ–°ç­é•¿å§“åä¸‹æ‹‰æ¡†
        function updateLeaderSelect() {
            leaderNameSelect.innerHTML = '<option value="">-- è¯·é€‰æ‹©ç­é•¿ --</option>';
            leaderNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                leaderNameSelect.appendChild(option);
            });
        }

        // ç”ŸæˆæŠ¥å‘Šäº‹ä»¶
        generateReportBtn.addEventListener('click', () => {
            const selectedLeader = leaderNameSelect.value;
            if (!selectedLeader) {
                alert('è¯·é€‰æ‹©ç­é•¿å§“åï¼');
                return;
            }

            if (Object.keys(excelData).length === 0) {
                alert('è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶ï¼');
                return;
            }

            generateReport(selectedLeader);
        });

        // æ‰“å°æŠ¥å‘Šäº‹ä»¶
        printReportBtn.addEventListener('click', () => {
            window.print();
        });

        // ç”ŸæˆæŠ¥å‘Š
        function generateReport(leaderName) {
            // è®¾ç½®æŠ¥å‘Šæ—¥æœŸå’Œç­é•¿å§“å
            const now = new Date();
            reportDate.textContent = `ç”Ÿæˆæ—¥æœŸ: ${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥`;
            reportLeaderName.textContent = leaderName;

            // ç­›é€‰æ•°æ®å¹¶ç”Ÿæˆè¡¨æ ¼
            displayWeldData(leaderName);
            displayStage1Data(leaderName);
            displayStage2InstallData(leaderName);
            displayStage2PrefabData(leaderName);

            // æ˜¾ç¤ºæŠ¥å‘Šå®¹å™¨
            reportContainer.classList.remove('hidden');
        }

        // æ˜¾ç¤ºç„Šå£æ•°æ®
        function displayWeldData(leaderName) {
            // æŸ¥æ‰¾åŒ¹é…çš„sheetï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
            const matchedSheet = Object.keys(excelData).find(key =>
                key.includes('ç„Šå£')
            );

            if (!matchedSheet || excelData[matchedSheet].length === 0) {
                weldData.innerHTML = '<div class="no-data">æ— ç›¸å…³æ•°æ®</div>';
                return;
            }

            const data = excelData[matchedSheet];
            const firstRow = data[0];

            // æŸ¥æ‰¾ç­é•¿å§“ååˆ—
            const leaderKey = Object.keys(firstRow).find(key =>
                key.includes('ç­é•¿') || key.includes('è´Ÿè´£äºº') || key.includes('å§“å')
            );

            if (!leaderKey) {
                weldData.innerHTML = '<div class="no-data">æ•°æ®ä¸­æœªæ‰¾åˆ°ç­é•¿å§“ååˆ—</div>';
                return;
            }

            // ç­›é€‰æ•°æ®
            const filteredData = data.filter(row => row[leaderKey] === leaderName);

            if (filteredData.length === 0) {
                weldData.innerHTML = '<div class="no-data">æ— ç›¸å…³æ•°æ®</div>';
                return;
            }

            // åˆ›å»ºè¡¨æ ¼
            const table = document.createElement('table');

            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');

            // ç„Šå£æ•°æ®éœ€è¦çš„åˆ—ï¼šåŒºåŸŸåˆ—ï¼Œæˆ¿é—´å·åˆ—ï¼Œç­‰è½´å›¾åˆ—ï¼Œç„Šå£å·åˆ—ï¼Œç„Šå£çº§åˆ«åˆ—
            const weldHeaders = ['åŒºåŸŸ', 'æˆ¿é—´å·', 'ç­‰è½´å›¾', 'ç„Šå£å·', 'ç„Šå£çº§åˆ«'];

            weldHeaders.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);
            table.appendChild(thead);

            // åˆ›å»ºè¡¨æ ¼å†…å®¹
            const tbody = document.createElement('tbody');

            filteredData.forEach(row => {
                const tr = document.createElement('tr');

                weldHeaders.forEach(header => {
                    const td = document.createElement('td');
                    // å°è¯•æ‰¾åˆ°åŒ¹é…çš„åˆ—ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
                    const columnKey = Object.keys(row).find(key =>
                        key.includes(header)
                    );
                    td.textContent = columnKey && row[columnKey] !== undefined && row[columnKey] !== null ? row[columnKey] : '';
                    tr.appendChild(td);
                });

                tbody.appendChild(tr);
            });

            table.appendChild(tbody);

            // æ¸…ç©ºå®¹å™¨å¹¶æ·»åŠ è¡¨æ ¼
            weldData.innerHTML = '';
            weldData.appendChild(table);
        }

        // æ˜¾ç¤ºä¸€é˜¶æ®µæ•°æ®
        function displayStage1Data(leaderName) {
            // æŸ¥æ‰¾åŒ¹é…çš„sheetï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
            const matchedSheet = Object.keys(excelData).find(key =>
                key.includes('ä¸€é˜¶æ®µ')
            );

            if (!matchedSheet || excelData[matchedSheet].length === 0) {
                stage1Data.innerHTML = '<div class="no-data">æ— ç›¸å…³æ•°æ®</div>';
                return;
            }

            const data = excelData[matchedSheet];
            const firstRow = data[0];

            // æŸ¥æ‰¾ç­é•¿å§“ååˆ—
            const leaderKey = Object.keys(firstRow).find(key =>
                key.includes('ç­é•¿') || key.includes('è´Ÿè´£äºº') || key.includes('å§“å')
            );

            if (!leaderKey) {
                stage1Data.innerHTML = '<div class="no-data">æ•°æ®ä¸­æœªæ‰¾åˆ°ç­é•¿å§“ååˆ—</div>';
                return;
            }

            // ç­›é€‰æ•°æ®
            const filteredData = data.filter(row => row[leaderKey] === leaderName);

            if (filteredData.length === 0) {
                stage1Data.innerHTML = '<div class="no-data">æ— ç›¸å…³æ•°æ®</div>';
                return;
            }

            // åˆ›å»ºè¡¨æ ¼
            const table = document.createElement('table');

            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');

            // ä¸€é˜¶æ®µæ•°æ®éœ€è¦çš„åˆ—ï¼šåŒºåŸŸåˆ—ï¼Œæˆ¿é—´å·åˆ—ï¼Œæ”¯æ¶å·åˆ—ï¼Œæ”¯æ¶çº§åˆ«åˆ—
            const stage1Headers = ['åŒºåŸŸ', 'æˆ¿é—´å·', 'æ”¯æ¶å·', 'æ”¯æ¶çº§åˆ«'];

            stage1Headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);
            table.appendChild(thead);

            // åˆ›å»ºè¡¨æ ¼å†…å®¹
            const tbody = document.createElement('tbody');

            filteredData.forEach(row => {
                const tr = document.createElement('tr');

                stage1Headers.forEach(header => {
                    const td = document.createElement('td');
                    // å°è¯•æ‰¾åˆ°åŒ¹é…çš„åˆ—ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
                    const columnKey = Object.keys(row).find(key =>
                        key.includes(header)
                    );
                    td.textContent = columnKey && row[columnKey] !== undefined && row[columnKey] !== null ? row[columnKey] : '';
                    tr.appendChild(td);
                });

                tbody.appendChild(tr);
            });

            table.appendChild(tbody);

            // æ¸…ç©ºå®¹å™¨å¹¶æ·»åŠ è¡¨æ ¼
            stage1Data.innerHTML = '';
            stage1Data.appendChild(table);
        }

        // æ˜¾ç¤ºäºŒé˜¶æ®µå®‰è£…æ•°æ®
        function displayStage2InstallData(leaderName) {
            // æŸ¥æ‰¾åŒ¹é…çš„sheetï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
            const matchedSheet = Object.keys(excelData).find(key =>
                key.includes('äºŒé˜¶æ®µå®‰è£…') || (key.includes('äºŒé˜¶æ®µ') && key.includes('å®‰è£…'))
            );

            if (!matchedSheet || excelData[matchedSheet].length === 0) {
                stage2InstallData.innerHTML = '<div class="no-data">æ— ç›¸å…³æ•°æ®</div>';
                return;
            }

            const data = excelData[matchedSheet];
            const firstRow = data[0];

            // æŸ¥æ‰¾ç­é•¿å§“ååˆ—
            const leaderKey = Object.keys(firstRow).find(key =>
                key.includes('ç­é•¿') || key.includes('è´Ÿè´£äºº') || key.includes('å§“å')
            );

            if (!leaderKey) {
                stage2InstallData.innerHTML = '<div class="no-data">æ•°æ®ä¸­æœªæ‰¾åˆ°ç­é•¿å§“ååˆ—</div>';
                return;
            }

            // ç­›é€‰æ•°æ®
            const filteredData = data.filter(row => row[leaderKey] === leaderName);

            if (filteredData.length === 0) {
                stage2InstallData.innerHTML = '<div class="no-data">æ— ç›¸å…³æ•°æ®</div>';
                return;
            }

            // åˆ›å»ºè¡¨æ ¼
            const table = document.createElement('table');

            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');

            // äºŒé˜¶æ®µå®‰è£…æ•°æ®éœ€è¦çš„åˆ—ï¼šåŒºåŸŸåˆ—ï¼Œæˆ¿é—´å·åˆ—ï¼Œæ”¯æ¶å·åˆ—ï¼Œæ”¯æ¶çº§åˆ«åˆ—ï¼Œæ”¯æ¶æ”¯ç‚¹åˆ—
            const stage2InstallHeaders = ['åŒºåŸŸ', 'æˆ¿é—´å·', 'æ”¯æ¶å·', 'æ”¯æ¶çº§åˆ«', 'å®‰è£…æ”¯ç‚¹'];

            stage2InstallHeaders.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);
            table.appendChild(thead);

            // åˆ›å»ºè¡¨æ ¼å†…å®¹
            const tbody = document.createElement('tbody');

            filteredData.forEach(row => {
                const tr = document.createElement('tr');

                stage2InstallHeaders.forEach(header => {
                    const td = document.createElement('td');
                    // å°è¯•æ‰¾åˆ°åŒ¹é…çš„åˆ—ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
                    let columnKey;
                    if (header === 'å®‰è£…æ”¯ç‚¹') {
                        // å¯¹äºå®‰è£…æ”¯ç‚¹ï¼ŒæŸ¥æ‰¾åŒ…å«"æ”¯ç‚¹"çš„åˆ—
                        columnKey = Object.keys(row).find(key =>
                            key.includes('æ”¯ç‚¹')
                        );
                    } else {
                        columnKey = Object.keys(row).find(key =>
                            key.includes(header)
                        );
                    }
                    td.textContent = columnKey && row[columnKey] !== undefined && row[columnKey] !== null ? row[columnKey] : '';
                    tr.appendChild(td);
                });

                tbody.appendChild(tr);
            });

            table.appendChild(tbody);

            // æ¸…ç©ºå®¹å™¨å¹¶æ·»åŠ è¡¨æ ¼
            stage2InstallData.innerHTML = '';
            stage2InstallData.appendChild(table);
        }

        // æ˜¾ç¤ºäºŒé˜¶æ®µé¢„åˆ¶æ•°æ®
        function displayStage2PrefabData(leaderName) {
            // æŸ¥æ‰¾åŒ¹é…çš„sheetï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
            const matchedSheet = Object.keys(excelData).find(key =>
                key.includes('äºŒé˜¶æ®µé¢„åˆ¶') || (key.includes('äºŒé˜¶æ®µ') && key.includes('é¢„åˆ¶'))
            );

            if (!matchedSheet || excelData[matchedSheet].length === 0) {
                stage2PrefabData.innerHTML = '<div class="no-data">æ— ç›¸å…³æ•°æ®</div>';
                return;
            }

            const data = excelData[matchedSheet];
            const firstRow = data[0];

            // æŸ¥æ‰¾ç­é•¿å§“ååˆ—
            const leaderKey = Object.keys(firstRow).find(key =>
                key.includes('ç­é•¿') || key.includes('è´Ÿè´£äºº') || key.includes('å§“å')
            );

            if (!leaderKey) {
                stage2PrefabData.innerHTML = '<div class="no-data">æ•°æ®ä¸­æœªæ‰¾åˆ°ç­é•¿å§“ååˆ—</div>';
                return;
            }

            // ç­›é€‰æ•°æ®
            const filteredData = data.filter(row => row[leaderKey] === leaderName);

            if (filteredData.length === 0) {
                stage2PrefabData.innerHTML = '<div class="no-data">æ— ç›¸å…³æ•°æ®</div>';
                return;
            }

            // åˆ›å»ºè¡¨æ ¼
            const table = document.createElement('table');

            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');

            // äºŒé˜¶æ®µé¢„åˆ¶æ•°æ®éœ€è¦çš„åˆ—ï¼šåŒºåŸŸåˆ—ï¼Œæˆ¿é—´å·åˆ—ï¼Œæ”¯æ¶å·åˆ—ï¼Œæ”¯æ¶çº§åˆ«åˆ—ï¼Œæ”¯æ¶æ”¯ç‚¹åˆ—
            const stage2PrefabHeaders = ['åŒºåŸŸ', 'æˆ¿é—´å·', 'æ”¯æ¶å·', 'æ”¯æ¶çº§åˆ«', 'é¢„åˆ¶æ”¯ç‚¹'];

            stage2PrefabHeaders.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);
            table.appendChild(thead);

            // åˆ›å»ºè¡¨æ ¼å†…å®¹
            const tbody = document.createElement('tbody');

            filteredData.forEach(row => {
                const tr = document.createElement('tr');

                stage2PrefabHeaders.forEach(header => {
                    const td = document.createElement('td');
                    // å°è¯•æ‰¾åˆ°åŒ¹é…çš„åˆ—ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
                    let columnKey;
                    if (header === 'é¢„åˆ¶æ”¯ç‚¹') {
                        // å¯¹äºé¢„åˆ¶æ”¯ç‚¹ï¼ŒæŸ¥æ‰¾åŒ…å«"æ”¯ç‚¹"çš„åˆ—
                        columnKey = Object.keys(row).find(key =>
                            key.includes('æ”¯ç‚¹')
                        );
                    } else {
                        columnKey = Object.keys(row).find(key =>
                            key.includes(header)
                        );
                    }
                    td.textContent = columnKey && row[columnKey] !== undefined && row[columnKey] !== null ? row[columnKey] : '';
                    tr.appendChild(td);
                });

                tbody.appendChild(tr);
            });

            table.appendChild(tbody);

            // æ¸…ç©ºå®¹å™¨å¹¶æ·»åŠ è¡¨æ ¼
            stage2PrefabData.innerHTML = '';
            stage2PrefabData.appendChild(table);
        }
    </script>
</body>

</html>